USE BASEBALL;

CALL INSERT_HOBBIES();

-- This query will show all the right fielder player's first name, last name, first start, their country of origin, language spoken, and hobbies.
SELECT DISTINCT POSITIONDESC AS 'POSITION', FIRSTNAME, LASTNAME, FIRSTSTART AS 'FIRST START', COUNTRY, LANGUAGE, TYPE AS 'HOBBY'
FROM PLAYER
LEFT JOIN POSITION ON PLAYER.POSITON=POSITION.POSITIONID
LEFT JOIN COUNTRYORGIN ON PLAYER.IDPLAYER=COUNTRYORGIN.IDPLAYER
LEFT JOIN HOBBIES ON PLAYER.IDPLAYER=HOBBIES.IDPLAYER
LEFT JOIN LANGUAGE ON PLAYER.IDPLAYER=LANGUAGE.IDPLAYER
WHERE POSITON = 9;

-- List the total number of singles for the top 20 players in 2019. List the first and last name, the total singles, and the year; sort by total singles from most to least.
SELECT FIRSTNAME, LASTNAME, SUM(SINGLE+(2*DOUBLES)+(3*TRIPLE)+(4*HR)) AS 'Total', YEARNUM AS 'YEAR'
FROM PLAYER P JOIN BATTING B ON P.idplayer = B.idPlayer
WHERE YEARNUM=2019
GROUP BY FIRSTNAME,LASTNAME, YEARNUM
ORDER BY SUM(B.SINGLE) DESC
LIMIT 20;

SELECT FIRSTNAME, LASTNAME, SUM(SINGLE+(2*DOUBLES)+(3*TRIPLE)+(4*HR)) AS 'Total', YEARNUM AS 'YEAR'
FROM PLAYER P JOIN BATTING B ON P.idplayer = B.idPlayer
WHERE YEARNUM=2019
GROUP BY FIRSTNAME,LASTNAME, YEARNUM
ORDER BY SUM(SINGLE+(2*DOUBLES)+(3*TRIPLE)+(4*HR)) DESC
LIMIT 20;

select * FROM PLAYER P JOIN BATTING B ON P.idplayer = B.idPlayer;

-- This query shows the first and last name of the players, the total strikes, and the total balls for players whose first start was no earlier than 2018. Sorted by last name.
SELECT FIRSTNAME, LASTNAME, FIRSTSTART, SUM(STRIKES) as 'TOTAL STRIKES',
SUM(BALLS) as 'TOTAL BALLS'
FROM PLAYER P JOIN GAMEDATA GD ON P.IDPLAYER = GD.IDPLAYER
WHERE FIRSTSTART > '2018-01-01'
GROUP by FIRSTNAME,LASTNAME,FIRSTSTART
ORDER BY LASTNAME ASC;

-- This query outputs the number of balls thrown from Boston on April 9, 2019
SELECT COUNT(BALLS) AS 'Number of Balls: April 9 2019'
FROM GAMEDATA
WHERE GAMEID = 'BOS201904090';

-- This query shows the top 10 players with the best batting average from best to worst. 
-- Show those player's First and last names, RBI, Singles, doubles, tripples, home runs, and batting averages.

SELECT FIRSTNAME, LASTNAME, SINGLE, DOUBLES, TRIPLE, HR, (HIT/AB) AS BATTING_AVERAGE
FROM PLAYER P
LEFT JOIN  BATTING B ON P.IDPLAYER=B.IDPLAYER
ORDER BY (HIT/AB) DESC 
LIMIT 10;

-- This query will show all the pitcherS on Boston who have played 10 or more games. It shows their first and last name, their team, and number of games played.
-- Sorted by most games to least games.
SELECT FIRSTNAME, LASTNAME, TEAM, GAMES
FROM PLAYER P
LEFT JOIN PITCH ON P.IDPLAYER=PITCH.IDPLAYER
LEFT JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
WHERE TEAM='BOS' AND GAMES>9
ORDER BY GAMES DESC;

-- This query shows all 2019 Boston player's; their first and last name, their games, at bats, hits, rbi's, 
-- and batting averages. Sorted by batting average in descending order; should NOT include players on roster with no game data.

SELECT DISTINCT R.YEARNUM AS 'YEAR', TEAM AS 'TEAM', FIRSTNAME AS 'FIRST', LASTNAME AS 'LAST', 
		GAMES, AB, HIT, (HIT/AB) AS BATTING_AVERAGE
FROM PLAYER P
INNER JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
INNER JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
WHERE R.TEAM LIKE 'BOS' AND R.YEARNUM=2019
ORDER BY BATTING_AVERAGE DESC;

-- This query will show all of the players with batting averages greater than the average batting year of 2019.
-- It will show the first name, last name, height, weight, and batting average of each of the players
-- sorted by batting average in descending order.

SELECT FIRSTNAME, LASTNAME, HEIGHT, WEIGHT, (HIT/AB) AS BATTING_AVERAGE
FROM PLAYER P
INNER JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
INNER JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
WHERE (HIT/AB)> (
	SELECT AVG(HIT/AB) AS BATTING_AVERAGE
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	INNER JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
    WHERE R.YEARNUM=2019 AND HIT!=0
)
ORDER BY BATTING_AVERAGE DESC;

	SELECT AVG(HIT/AB) AS BATTING_AVERAGE
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	INNER JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
    WHERE R.YEARNUM=2019 AND HIT!=0;

-- This query shows the player with the best batting average at each position (not including pitcher). 
-- Show the first name, last name, position, and batting average.

SELECT FIRSTNAME, LASTNAME, POSITIONDESC, (HIT/AB) AS BAT_AVG
FROM PLAYER P
LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
INNER JOIN(
	SELECT MAX(HIT/AB) AS BATTING_AVERAGE, Positon
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	GROUP BY POSITON
) S ON P.POSITON = S.POSITON AND (HIT/AB)=S.BATTING_AVERAGE
LEFT JOIN POSITION ON P.POSITON=POSITION.POSITIONID;


SELECT DISTINCT FIRSTNAME, LASTNAME, POSITIONDESC, (HIT/AB) AS BAT_AVG
FROM PLAYER P
LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
INNER JOIN(
	SELECT MAX(HIT/AB) AS BATTING_AVERAGE, Positon
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	GROUP BY POSITON
) S ON P.POSITON = S.POSITON AND ROUND((HIT/AB),4)=ROUND(S.BATTING_AVERAGE,4)
LEFT JOIN POSITION ON P.POSITON=POSITION.POSITIONID
WHERE POSITION.POSITIONDESC IS NOT NULL AND POSITIONDESC != "Pitcher";


-- This query will show the player with the best batting average on Boston in 2019, and show all of the game data against 
-- Toronto. Show the balls, strikes, score, opponent score, first and last name.

SELECT GAMEID, FIRSTNAME, LASTNAME, SUM(BALLS) AS "BALLS", SUM(STRIKES) AS "STRIKES", MAX(HOMESCORE) AS "HOMESCORE", MAX(OPPSCORE) AS "OPPSCORE"
FROM GAMEDATA G
INNER JOIN PLAYER P ON G.IDPLAYER = P.IDPLAYER
WHERE P.IDPLAYER=(
	SELECT P.IDPLAYER
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	RIGHT JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
	WHERE R.TEAM='ARI' AND R.YEARNUM=2019
	ORDER BY (HIT/AB) DESC LIMIT 1
) AND OPPID="BOS"
GROUP BY GAMEID, FIRSTNAME, LASTNAME;

	SELECT P.IDPLAYER
	FROM PLAYER P
	LEFT JOIN BATTING B ON P.IDPLAYER=B.IDPLAYER
	RIGHT JOIN ROSTER R ON P.IDPLAYER=R.IDPLAYER
	WHERE R.TEAM='ARI' AND R.YEARNUM=2019
	ORDER BY (HIT/AB) DESC LIMIT 1;

select * from gamedata where idPlayer = "martk001";

